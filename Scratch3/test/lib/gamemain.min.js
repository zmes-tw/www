var regEx=/\[[A-Za-z0-9]+\]/;function setText(textObj,str,line,exYBoolean){if(exYBoolean||(exYBoolean=!1),str){var _st,_sc,sAry=[],xAry=[];textObj.x=exYBoolean?textObj.x:70,textObj.lineWidth=exYBoolean?textObj.lineWidth:820,textObj.text="",textObj.maxWidth=null;for(var vt=[],aIndex0=0;;){var a=str.match(regEx);if(null==a)break;(a.g=a.index,vt.push(a),0!=a.index||exYBoolean)?str=str.replace(regEx,"　　　"):(textObj.x=270,textObj.lineWidth=620,str=str.replace(regEx,""),aIndex0=1)}for(var i=0;i<str.length;i++){for(var c in xAry.push(textObj.getMeasuredWidth()),"\n"==str.charAt(i)?(sAry.push(textObj.text),textObj.text=""):textObj.text=textObj.text+str.charAt(i),textObj.getMeasuredWidth()>textObj.lineWidth&&(textObj.text=textObj.text.slice(0,-1),sAry.push(textObj.text),textObj.text=str.charAt(i)),vt)vt[c].index==i&&(vt[c].g=vt[c].index,vt[c].regY=sAry.length*textObj.lineHeight,vt[c].line=sAry.length);if(sAry.length>=line||i==str.length-1){sAry.push(textObj.text),textObj.text="";for(var c=0;c<sAry.length;c++)textObj.text=textObj.text+sAry[c]+"\n";if(sAry.length>line){_st=textObj.text.slice(0,-3),textObj.text=_st+"..",textObj.maxWidth=textObj.lineWidth;break}}}for(var v in vt)vt[v].regX=xAry[vt[v].g+vt[v].line],vt[v].regX=1==aIndex0?vt[v].regX-60*(vt[v].line+1):vt[v].regX,vt[v].picW=180,vt[v].picH=textObj.lineHeight;if(exYBoolean&&(textObj.y=1==sAry.length?195:180),0!=vt.length){var tspAry=[];for(var pv in vt){var tsp=new createjs.Bitmap(images[vt[pv][0].slice(1,-1)]),_v,_h;switch(!0){case exYBoolean:_sc=(_v=180/tsp.image.width)>(_h=80/tsp.image.height)?_h:_v,tsp.x=textObj.x-tsp.image.width*_sc/2,tsp.y=textObj.y-10,textObj.text="";break;case 0==vt[pv].index:_sc=(_v=240/tsp.image.width)>(_h=240/tsp.image.height)?_h:_v,tsp.x=15,tsp.y=5;break;default:_sc=(_v=vt[pv].picW/tsp.image.width)>(_h=vt[pv].picH/tsp.image.height)?_h:_v,tsp.x=textObj.x+vt[pv].regX+Math.abs(vt[pv].picW-tsp.image.width*_sc)/2,tsp.y=textObj.y+vt[pv].regY+Math.abs(vt[pv].picH-tsp.image.height*_sc)/2}tsp.scaleX=_sc,tsp.scaleY=_sc,textObj.parent.addChild(tsp),tspAry.push(tsp)}textObj.parent.tspAry=tspAry}}}!function(q){var qusAry,titleBMP,classP,SRCIMG="./images/",SRCSUD="./sounds/";function resize_canvas(){now_sc=$(window).width()/$(window).height(),set_sc=16/9,now_sc<=set_sc?scale=$(window).width()/1280:scale=$(window).height()/720,$("#wrapper").css("width",1280*scale),$("#wrapper").css("height",720*scale),$("#preload").css("width",1280*scale),$("#preload").css("height",720*scale),$("#preload > img").css("width",200*scale),$("#preload > img").css("height",200*scale),$("#robot").css("transform","translate(-50%,-50%) scale("+1.4*scale+")")}function gameJsFn(){console.log("校園文化製作 http://www.eduweb.idv.tw/"),root.edulogo.addEventListener("click",function(){window.open(" http://www.eduweb.idv.tw/ ","校園文化")}),root.musBtn.addEventListener("mouseover",function(){}),root.musBtn.addEventListener("click",function(){mus_bo=!mus_bo,mus_bo?createjs.Sound.muted=!1:createjs.Sound.muted=!0,root.musBtn.gotoAndStop(Number(mus_bo))}),mus_bo=!0,root.musBtn.cursor="pointer",root.musBtn.hitArea=root.musBtn.getChildAt(0),root.musBtn.gotoAndStop(1),titleBMP=new createjs.Bitmap(images["title"+classP]),root.addChild(titleBMP),titleSetPosition()}function titleSetPosition(){titleBMP.scaleX=titleBMP.scaleY=1.1,titleBMP.x=365,titleBMP.y=140,stage.update()}function stage0Fn(){root.gotoAndStop(0),titleSetPosition(),createjs.Sound.stop(),createjs.Sound.play("bg00",{loop:-1}),root.start_btn.addEventListener("click",clickFn)}function stage1Fn(){root.gotoAndStop(1),root.star.visible=!1,root.yes.visible=!1,titleBMP.scaleX=titleBMP.scaleY=.4,titleBMP.x=5,titleBMP.y=10,stage.update(),createjs.Sound.stop(),createjs.Sound.play("bg01",{loop:-1}),nowQus=0,qusAry=(qusAry=[]).concat(q["q"+(classP=classP||1)]);var i=10;for(root.star.x=505;i>0;)i>qusAry.length&&(root.star["st"+i].visible=!1,root.star.x+=60),root.star["st"+i].gotoAndStop(0),i--;root.star.visible=!0,root.yes.stop(),root.star.st1.gotoAndPlay(1),root.btn0.addEventListener("click",clickFn),root.btn1.addEventListener("click",clickFn),root.btn2.addEventListener("click",clickFn),hideBtnFn()}function stage2Fn(){root.gotoAndStop(2),titleBMP.scaleX=titleBMP.scaleY=1,titleBMP.x=560-titleBMP.image.width/2,titleBMP.y=2,stage.update(),createjs.Sound.stop(),createjs.Sound.play("fail",{loop:1}),createjs.Sound.play("fail2",{loop:-1}),root.restart_btn.addEventListener("click",clickFn)}function stage3Fn(){root.gotoAndStop(3),titleBMP.scaleX=titleBMP.scaleY=1.2,titleBMP.x=640-1.2*titleBMP.image.width/2,titleBMP.y=20,stage.update(),spritSheetAry=[];for(var ss=1;ss<=12;ss++){var fireworkSpMc=new createjs.Sprite(new createjs.SpriteSheet({images:[images.fireworkSp],frames:{width:210,height:200},animations:{loop:[0,23,"wait"],wait:{frames:[23,23,23,23,23,23,23,23],next:"loop"}}}),"loop");fireworkSpMc.currentFrame=0,fireworkSpMc.scaleX=fireworkSpMc.scaleY=Math.floor(4*Math.random())+2,fireworkSpMc.x=Math.floor(900*Math.random())-200,fireworkSpMc.y=Math.floor(300*Math.random())-100,spritSheetAry.push(fireworkSpMc),root.addChild(fireworkSpMc),fireworkSpMc.gotoAndPlay(Math.floor(23*Math.random()))}createjs.Sound.stop(),createjs.Sound.play("firework",{loop:-1}),root.backmain_btn.addEventListener("click",clickFn)}function hideBtnFn(){if(root.no1.txt.text="",root.no1.tspAry){var ary=root.no1.tspAry;for(var a in ary)root.no1.removeChild(ary[a])}for(var i=0;i<=2;i++){if(root["c"+i].gotoAndStop(0),root["c"+i].txt.text="",root["c"+i].tspAry){var ary=root["c"+i].tspAry;for(var a in ary)root["c"+i].removeChild(ary[a])}root["btn"+i].visible=!1}stage.update(),setTimeout(function(){0==qusAry.length?stage3Fn():qusNext()},500)}function clickFn(e){switch(e.target){case root.start_btn:root.start_btn.removeEventListener("click",clickFn),stage1Fn();break;case root.restart_btn:root.restart_btn.removeEventListener("click",clickFn),stage1Fn();break;case root.backmain_btn:for(var i in spritSheetAry)root.removeChild(spritSheetAry[i]);spritSheetAry=[],root.backmain_btn.removeEventListener("click",clickFn),stage0Fn();break;case root.btn0:ansFn(1,e.target.rr);break;case root.btn1:ansFn(2,e.target.rr);break;case root.btn2:ansFn(3,e.target.rr)}}function ansFn(ans,rr){return 1==rr?(root.star["st"+(++nowQus+1)].gotoAndPlay(1),root.yes.gotoAndPlay(1),root.yes.visible=!0,createjs.Sound.play("right",{loop:1}),hideBtnFn(),!0):(root.btn0.removeEventListener("click",clickFn),root.btn1.removeEventListener("click",clickFn),root.btn2.removeEventListener("click",clickFn),stage2Fn(),!1)}function qusNext(){var c=Math.floor(Math.random()*qusAry.length),qus=qusAry[c].qus,optAry=[];optAry=optAry.concat(qusAry[c].opt),qusAry.splice(c,1),setTimeout(function(){for(setText(root.no1.txt,qus,3),root.btn0.visible=!0,root.btn1.visible=!0,root.btn2.visible=!0,root.c0.gotoAndStop(1),root.c1.gotoAndStop(1),root.c2.gotoAndStop(1),root.c0.ss.play(),root.c1.ss.play(),root.c2.ss.play();optAry.length>0;){var t=optAry.length,i=Math.floor(Math.random()*t);root["btn"+(3-optAry.length)].rr=optAry[i].length>1?1:0,setText(root["c"+(3-optAry.length)].txt,optAry[i][0],2,!0),optAry.splice(i,1)}},500)}window.onload=function(){canvas=document.getElementById("canvas"),images=images||{};var manifest=[{src:SRCIMG+"gamebg.png",id:"mainbg"},{src:SRCIMG+"gamebg.png",id:"gamebg"},{src:SRCIMG+"gamebg.png",id:"losebg"},{src:SRCIMG+"endbg.png",id:"endbg"},{src:SRCIMG+"firework_Spritesheet6x4.png",id:"fireworkSp"},{src:SRCIMG+"titlebg.png",id:"titlebg"},{src:SRCSUD+"classover.mp3",id:"classover"},{src:SRCSUD+"dinedine.mp3",id:"dinedine"},{src:SRCSUD+"fail.mp3",id:"fail"},{src:SRCSUD+"fail2.mp3",id:"fail2"},{src:SRCSUD+"right.mp3",id:"right"},{src:SRCSUD+"bg00.mp3",id:"bg00"},{src:SRCSUD+"bg01.mp3",id:"bg01"},{src:SRCSUD+"firework.mp3",id:"firework"}],url=location.href;if(-1!=url.indexOf("?")){var ary=url.split("?")[1].split("&");for(i=0;i<=ary.length-1;i++)"p"==ary[i].split("=")[0]&&(classP=ary[i].split("=")[1])}classP=classP||1,manifest=manifest.concat(sortManifestQ(q,classP)),document.title=q.title,resize_canvas(),createjs.Sound.registerPlugins([createjs.HTMLAudioPlugin]);var loader=new createjs.LoadQueue(!1);function sortManifestQ(obj,p){var _tmp=".png",_obj=obj["q"+p],maniAry=[];for(var q in maniAry.push({src:SRCIMG+"title"+p+_tmp,id:"title"+p}),_obj)for(var o in maniAry=maniAry.concat(strMatch(_obj[q].qus)),_obj[q].opt)maniAry=maniAry.concat(strMatch(_obj[q].opt[o][0]));return maniAry;function strMatch(str){for(var ary=[];;){var a=str.match(regEx);if(null==a)return ary;a[0]=a[0].slice(1,-1),ary.push({src:SRCIMG+a[0]+_tmp,id:a[0]}),str=str.replace(regEx,"")}}}function handleFileLoad(evt){"image"==evt.item.type&&(images[evt.item.id]=evt.result)}function handleComplete(){$("#preload").css("display","none"),exportRoot=new lib.game,stage=new createjs.Stage(canvas),stage.addChild(exportRoot),stage.update(),stage.enableMouseOver(),gameJsFn(),createjs.Ticker.framerate=12,createjs.Ticker.addEventListener("tick",stage),stage0Fn()}loader.installPlugin(createjs.Sound),loader.addEventListener("fileload",handleFileLoad),loader.addEventListener("complete",handleComplete),loader.loadManifest(manifest)},$(window).resize(function(){resize_canvas()}),resize_canvas()}(JSON.parse(qq_str));